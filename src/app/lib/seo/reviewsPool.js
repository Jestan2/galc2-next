// src/lib/seo/reviewsPool.js

/* -------------------------------------------------------------------------- */
/* Review pool (real excerpts from Google Business Profile)                    */
/* -------------------------------------------------------------------------- */

export const REVIEW_POOL = [
  {
    id: "r001",
    name: "T.S.",
    stars: 5,
    text:
      "I called in two hours of my service same day and they came packed up. Everything emergency cleanup, thank you.",
    location: "",
  },
  {
    id: "r002",
    name: "M.P.",
    stars: 5,
    text:
      "The service I received was outstanding. The mover Jesse who assisted me was friendly, very helpful and did a good job. I would definitely recommend this company to anyone who needs assistance with loading and unloading a truck.",
    location: "",
  },
  {
    id: "r003",
    name: "G.I.A.",
    stars: 5,
    text:
      "I needed help preparing for a garage sale. The company was very professional, courteous and detailed oriented. They provided the workers picture and checked in with me. The employee was Stephen. He was incredibly courteous, very efficient, had high work ethics and made use of every minute he was here. All in all, I highly recommend both the company and the employee.",
    location: "",
  },
  {
    id: "r004",
    name: "K.R.",
    stars: 5,
    text:
      "Hire two workers to help clear out my new house. Tons of junk in the backyard and basement. Vaughn and Jeff were amazing! Super hard workers. I could not ask for a better experience.",
  },
  {
    id: "r005",
    name: "B.L.",
    stars: 5,
    text:
      "The atmosphere at the convention center was amazing we unloaded and moved clothing, shelves and assemblies tables chairs and lockers everyone was amazing we all worked great together",
    location: "",
  },
  {
    id: "r006",
    name: "J.E.",
    stars: 5,
    text:
      "Dave did a great job! He arrived on time. After a quick explanation of what was needed, he went right to work and didn’t stop until the job was done",
    location: "",
  },
  {
    id: "r007",
    name: "T.A.",
    stars: 5,
    text:
      "The moving jobs are localized, the service is excellent and on point, the movers/helpers I work with are Profesional, and the pay is immediate, I thank you, one love and respects, bless up.",
    location: "",
  },
  {
    id: "r008",
    name: "T.",
    stars: 5,
    text:
      "I had very very good experience with the two guys that came to move my stuff in Lawrenceville Georgia. They did an excellent job. Please please let them know, bravo to them. They were very Respectful and professional.",
    location: "",
  },
  {
    id: "r009",
    name: "R.S.",
    stars: 5,
    text:
      "The worker was 30 minutes early, and was ready to start as soon as we pulled in the drive. Cheerful, hardworking, and pleasant to work with, he gave me exactly the help I needed to move into my new home.",
    location: "",
  },
  {
    id: "r010",
    name: "A.F.",
    stars: 5,
    text:
      "They provided movers at the last minute which was a lifesaver. Two gentlemen arrived and handled all of our heaviest things with a smile. Would hire again!",
    location: "",
  },
  {
    id: "r011",
    name: "J.M.",
    stars: 5,
    text:
      "Easy, affordable and really nice dudes showed up to help me unload my uhaul trailer. Took them 30 min, highly recommend",
    location: "",
  },
  {
    id: "r012",
    name: "G.P.",
    stars: 5,
    text:
      "Great, great service! We've used this service many times now. Almost all of their workers have been excellent. Their back office is superb. The company is very responsive. Strongly recommend!",
    location: "",
  },
  {
    id: "r013",
    name: "M.M.",
    stars: 5,
    text:
      "Great Services...and excellent communication throughout...for clients and contractors/ service providers both. Highly recommended for all your moving needs!",
    location: "",
  },
  {
    id: "r014",
    name: "H.H.",
    stars: 5,
    text:
      "This was a last minute need and Derek was sent out to help! He worked hard and eased my anxiety about moving. I appreciate the way the company communicated to make sure everything went smoothly. I will use them again when the need arises!",
    location: "",
  },
  {
    id: "r015",
    name: "Verified Google Review",
    stars: 5,
    text:
      "Logan did a great job! He was prompt, very respectful, hard working, and cheerful. Booking was easy, and all went as scheduled.",
    location: "",
  },
  {
    id: "r016",
    name: "B.B.",
    stars: 5,
    text:
      "Cannot say enough good things about this company! They sent 2 guys within a couple of hours to help me move after my original moving company canceled on me at the last minute. The guys were hardworking, respectful, and fast!",
    location: "",
  },
  {
    id: "r017",
    name: "P.S.",
    stars: 5,
    text:
      "Excellent value and worth every penny! I was a little hesitant to go this route but after contacting 3 other labor services with zero results, this was great. Update -- used again and the worker did very good work for me.",
    location: "",
  },
  {
    id: "r018",
    name: "N.J.",
    stars: 5,
    text:
      "Asked for 2 contractors. The appointment was easy to set up. Both workers showed up on time. They were both polite and very hard workers. I was exceptionally pleased with their work.",
    location: "",
  },
  {
    id: "r019",
    name: "M.J.",
    stars: 5,
    text:
      "I was pleasantly surprised. The labors showed up on time and were literally some of the best movers I've ever had. They helped break down furniture and moved furniture with no hesitation. Great experience.",
    location: "",
  },
  {
    id: "r020",
    name: "S.H.",
    stars: 5,
    text:
      "I had one guy, Michael, help load the truck and he was fast and efficient. Then Romelo helped me unload the truck at my final destination. This was my 1st time using GALC and I plan on using them again.",
    location: "",
  },
  {
    id: "r021",
    name: "A.B.",
    stars: 5,
    text:
      "I was able to hire two people for labor with for my move on short notice! They sent help in less than 3 hours and the help was very professional and completed the requested job in the desired time.",
    location: "",
  },
  {
    id: "r022",
    name: "R.M.",
    stars: 5,
    text:
      "The laborer they sent was Raymond from Cape Coral. He was unbelievably friendly, pleasant, professional. Such a nice guy who worked so hard for us. Overall it was a very easy, professional, and smooth experience.",
    location: "",
  },
  {
    id: "r023",
    name: "A.T.",
    stars: 5,
    text:
      "The man who showed up was nothing short of a damn Avenger. He moved more of my stuff in 20 mins than I could all morning. I highly recommend this company and their professionals. The price was right.",
    location: "",
  },
  {
    id: "r024",
    name: "B.R.",
    stars: 5,
    text:
      "The best moving company I have used so far. Customer service was responsive and the movers were quick and efficient.",
    location: "",
  },
  {
    id: "r025",
    name: "K.K.",
    stars: 5,
    text:
      "I had a really good experience hiring a laborer for one of our junk removal projects. He showed up on time and worked hard.",
    location: "",
  },
    {
    id: "r026",
    name: "S.G.",
    stars: 5,
    text:
      "These guys went above and beyond! They worked hard and did much more than we thought they'd be able to do. Really appreciate their work and will definitely use again",
    location: "",
  },
    {
    id: "r027",
    name: "E.R.",
    stars: 5,
    text:
      "The workers showed up on time, very kind and did everything I asked. The company checked in to make sure I was satisfied. Will use them again for sure",
    location: "",
  },
    {
    id: "r028",
    name: "J.R.",
    stars: 5,
    text:
      "I have used the company twice, first time for yard work and second time for help with house cleaning/packing. It was a real life saver for me in a moving pinch. And saved me money. Would use again.",
    location: "",
  },
    {
    id: "r029",
    name: "M.F.",
    stars: 5,
    text:
      "They do great work. They're fast and reliable. I cannot recommend the Great American Labor Company highly enough.",
    location: "",
  },
    {
    id: "r030",
    name: "S.M.",
    stars: 5,
    text:
      "If every worker is as good as Tyler is with moving, you guys will put EVERYONE out of business. I wish I could give more than 5 stars. He was extremely quick and so nice. Handled all of my stuff with care. I will definitely use you guys in the future, thank you thank you!",
    location: "",
  },
];

/* -------------------------------------------------------------------------- */
/* SEO-safe “random” picking (deterministic per page)                          */
/* -------------------------------------------------------------------------- */

function normalize(s) {
  return (s || "")
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, " ")
    .trim();
}

function bucketForServiceSlug(serviceSlug) {
  const s = (serviceSlug || "").toLowerCase();
  if (s.includes("moving")) return "moving";
  if (s.includes("junk") || s.includes("cleanout")) return "cleanout";
  if (s.includes("warehouse")) return "warehouse";
  if (s.includes("event")) return "event";
  if (s.includes("construction")) return "construction";
  return "general";
}

const BUCKET_KEYWORDS = {
  moving: ["move", "moving", "mover", "uhaul", "truck", "load", "unload", "stairs", "storage"],
  cleanout: ["junk", "cleanout", "garage", "trash", "removal", "basement", "backyard", "furniture"],
  warehouse: ["warehouse", "dock", "freight", "pallet", "container", "unloading", "staging"],
  event: ["event", "convention", "center", "chairs", "tables", "venue", "setup", "teardown"],
  construction: ["construction", "jobsite", "debris", "post construction", "site cleanup"],
  general: [],
};

function matchesBucket(reviewText, bucket) {
  const t = normalize(reviewText);
  const keys = BUCKET_KEYWORDS[bucket] || [];
  if (!keys.length) return true;
  return keys.some((k) => t.includes(k));
}

/* Simple seeded PRNG (fast + deterministic) */
function xmur3(str) {
  let h = 1779033703 ^ str.length;
  for (let i = 0; i < str.length; i++) {
    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
  }
  return function () {
    h = Math.imul(h ^ (h >>> 16), 2246822507);
    h = Math.imul(h ^ (h >>> 13), 3266489909);
    return (h ^= h >>> 16) >>> 0;
  };
}

function mulberry32(a) {
  return function () {
    let t = (a += 0x6d2b79f5);
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function seededShuffle(arr, seedStr) {
  const seedFn = xmur3(seedStr);
  const rand = mulberry32(seedFn());
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(rand() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/**
 * Pick 3 “random” reviews in an SEO-safe way:
 * - Stable per page (seeded by slug)
 * - Prefer service-relevant reviews
 * - Prefer city-matching reviews if available
 */
export function pickFeaturedReviews({ serviceSlug, citySlug, cityName = "", count = 3 }) {
  const bucket = bucketForServiceSlug(serviceSlug);
  const city = normalize(cityName);

  // 1) service-relevant
  let pool = REVIEW_POOL.filter((r) => matchesBucket(r.text, bucket));

  // 2) if on a city page, prefer reviews that mention the city (if any exist)
  if (city && citySlug) {
    const cityMatches = pool.filter((r) => normalize(r.text).includes(city) || normalize(r.location).includes(city));
    if (cityMatches.length >= count) pool = cityMatches;
  }

  // 3) fallback if bucket too small
  if (pool.length < count) pool = REVIEW_POOL;

  // 4) deterministic shuffle per page
  const seed = citySlug ? `${serviceSlug}::${citySlug}` : `${serviceSlug}`;
  const shuffled = seededShuffle(pool, seed);

  return shuffled.slice(0, count);
}